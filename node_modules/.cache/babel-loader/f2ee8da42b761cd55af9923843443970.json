{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Asus\\\\Documents\\\\GitHub\\\\IntercomBL\\\\WebManangerServer\\\\cliente\\\\WebManangerClient\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Asus\\\\Documents\\\\GitHub\\\\IntercomBL\\\\WebManangerServer\\\\cliente\\\\WebManangerClient\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Asus\\\\Documents\\\\GitHub\\\\IntercomBL\\\\WebManangerServer\\\\cliente\\\\WebManangerClient\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import{REGISTRO_ERROR,REGISTRO_EXITOSO,OBTENER_USUARIO,LOGIN_ERROR,LOGIN_EXITOSO,CERRAR_SESION}from'../../types';import authReducer from'./authReducer';import AuthContext from'./authContext';import clienteAxios from'../../config/axios';import tokenAuth from'../../config/tokenAuth';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),autenticado:null,usuario:null,mensaje:null,cargando:true};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post('/api/usuarios',datos);case 3:respuesta=_context.sent;console.log(respuesta.data);dispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});//obtener el usuario\nusuarioAutenticado();_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);//console.log(error.response.data.msg);\nalerta={msg:_context.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:REGISTRO_ERROR,payload:alerta});case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();//retorna el usuario autenticado\nvar usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem('token');if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get('/api/auth');case 5:respuesta=_context2.sent;//console.log(respuesta);\ndispatch({type:OBTENER_USUARIO,payload:respuesta.data.usuario});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0.response);dispatch({type:LOGIN_ERROR});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();//cuando el usuario inicia sesion \nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post('/api/auth',datos);case 3:respuesta=_context3.sent;dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});//obtener el usuario\nusuarioAutenticado();_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);alerta={msg:_context3.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:LOGIN_ERROR,payload:alerta});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();//Cierra la sesion del usuario\nvar cerrarSesion=function cerrarSesion(){dispatch({type:CERRAR_SESION});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,registrarUsuario:registrarUsuario,iniciarSesion:iniciarSesion,usuarioAutenticado:usuarioAutenticado,cerrarSesion:cerrarSesion}},props.children);};export default AuthState;","map":{"version":3,"sources":["C:/Users/Asus/Documents/GitHub/IntercomBL/WebManangerServer/cliente/WebManangerClient/src/context/autenticacion/authState.js"],"names":["React","useReducer","REGISTRO_ERROR","REGISTRO_EXITOSO","OBTENER_USUARIO","LOGIN_ERROR","LOGIN_EXITOSO","CERRAR_SESION","authReducer","AuthContext","clienteAxios","tokenAuth","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","datos","post","respuesta","console","log","data","type","payload","usuarioAutenticado","alerta","msg","response","categoria","get","iniciarSesion","cerrarSesion","children"],"mappings":"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","sourcesContent":["import React, {useReducer} from 'react';\r\nimport {REGISTRO_ERROR,REGISTRO_EXITOSO,\r\n    OBTENER_USUARIO,LOGIN_ERROR,\r\n    LOGIN_EXITOSO,CERRAR_SESION\r\n} from'../../types';\r\nimport authReducer from './authReducer';\r\nimport AuthContext from './authContext';\r\nimport clienteAxios from '../../config/axios';\r\nimport tokenAuth from '../../config/tokenAuth';\r\n\r\nconst AuthState = props => {\r\n    const initialState = {\r\n        token: localStorage.getItem('token'),\r\n        autenticado: null,\r\n        usuario: null,\r\n        mensaje: null,\r\n        cargando: true\r\n    }\r\n    const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n    const registrarUsuario = async datos => {\r\n        try {\r\n            const respuesta = await clienteAxios.post('/api/usuarios',datos);\r\n            console.log(respuesta.data);\r\n            dispatch({\r\n                type: REGISTRO_EXITOSO,\r\n                payload: respuesta.data\r\n            })\r\n\r\n            //obtener el usuario\r\n            usuarioAutenticado();\r\n        } catch (error) {\r\n            //console.log(error.response.data.msg);\r\n             const alerta = {\r\n                 msg: error.response.data.msg,\r\n                 categoria: 'alerta-error'\r\n             }\r\n            dispatch({\r\n                type: REGISTRO_ERROR,\r\n                payload: alerta\r\n            })\r\n        }\r\n    }\r\n    //retorna el usuario autenticado\r\n    const usuarioAutenticado = async () => {\r\n        const token = localStorage.getItem('token');\r\n        if(token){\r\n            tokenAuth(token);\r\n        }\r\n        try {\r\n            const respuesta = await clienteAxios.get('/api/auth');\r\n            //console.log(respuesta);\r\n            dispatch({\r\n                type: OBTENER_USUARIO,\r\n                payload: respuesta.data.usuario\r\n            })\r\n        } catch (error) {\r\n            console.log(error.response);\r\n            dispatch({\r\n                type: LOGIN_ERROR\r\n            })\r\n        }\r\n    }\r\n\r\n    //cuando el usuario inicia sesion \r\n\r\n    const iniciarSesion = async datos => {\r\n        try {\r\n            const respuesta = await clienteAxios.post('/api/auth',datos);\r\n            dispatch({\r\n                type:LOGIN_EXITOSO,\r\n                payload: respuesta.data\r\n            });\r\n            //obtener el usuario\r\n            usuarioAutenticado();\r\n        } catch (error) {\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'alerta-error'\r\n            }\r\n           dispatch({\r\n               type: LOGIN_ERROR,\r\n               payload: alerta\r\n           })\r\n        }\r\n    }\r\n    //Cierra la sesion del usuario\r\n    const cerrarSesion = () => {\r\n        dispatch({\r\n            type: CERRAR_SESION\r\n        })\r\n    }\r\n    return(\r\n        <AuthContext.Provider\r\n        value={{\r\n            token: state.token,\r\n            autenticado: state.autenticado,\r\n            usuario: state.usuario,\r\n            mensaje: state.mensaje,\r\n            cargando: state.cargando,\r\n            registrarUsuario,\r\n            iniciarSesion,\r\n            usuarioAutenticado,\r\n            cerrarSesion\r\n        }}\r\n        >\r\n\r\n        {props.children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}